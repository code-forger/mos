#include "../../stdlib/stdio.h"
#include "../../stdlib/pipe.h"
#include "../../stdlib/process.h"


asm(".global _start");
asm("_start:");
asm("    sti");
asm("    call main");



/*uint32_t pipe(PIPE[2]);
uint32_t write(PIPE pipe, uint8_t data);
int64_t read(PIPE pipe);*/

void main(void)
{
    const char* l1  = "**********************************************************";
    const char* l2  = "**********************************************************";
    const char* l3  = "**********************************************************";
    const char* l4  = "**********************************************************";
    const char* l5  = "**********************************************************";
    const char* l6  = "**********************************************************";
    const char* l7  = "**********************************************************";
    const char* l8  = "**********************************************************";
    const char* l9  = "**********************************************************";
    const char* l10  = "**********************************************************";
    const char* l11  = "**********************************************************";
    const char* l12  = "**********************************************************";
    const char* l13  = "**********************************************************";
    const char* l14  = "**********************************************************";
    const char* l15  = "**********************************************************";
    const char* l16  = "**********************************************************";
    const char* l17  = "**********************************************************";
    const char* l18  = "**********************************************************";
    const char* l19  = "**********************************************************";
    const char* l20  = "**********************************************************";
    PIPE pipes[2];
    pipe(pipes);
    uint32_t id = fork();
    if (id==get_pid())
    {
        stdin_init();
        setio(35, 1, 5, 5);
        char c = 'a';
        while(c = getchar())
        {
            printf("%c", (char)c);
            write(pipes[0], c);
        }
    }
    else
    {
        setio(27, 1, 5, 5);
        int64_t out;
        while (1)
        {
            while ((out = read(pipes[1])) < 0);
            uint8_t c = (uint8_t)out;
            printf("%c", (char)c);
        }
    }
    for(;;);
}